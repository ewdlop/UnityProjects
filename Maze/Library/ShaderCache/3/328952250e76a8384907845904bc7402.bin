rmanceCounters> PerformanceCountersForEndpointList
        {
            get
            {
                if (PerformanceCounters.performanceCountersList == null)
                {
                    lock (PerformanceCounters.perfCounterDictionarySyncObject)
                    {
                        if (PerformanceCounters.performanceCountersList == null)
                        {
                            PerformanceCounters.performanceCountersList = new List<ServiceModelPerformanceCounters>();
                        }
                    }
                }
                return PerformanceCounters.performanceCountersList;
            }
        }

        internal static Dictionary<string, ServiceModelPerformanceCountersEntry> PerformanceCountersForBaseUri
        {
            get
            {
                if (PerformanceCounters.performanceCountersBaseUri == null)
                {
                    lock (PerformanceCounters.perfCounterDictionarySyncObject)
                    {
                        if (PerformanceCounters.performanceCountersBaseUri == null)
                        {
                            PerformanceCounters.performanceCountersBaseUri = new Dictionary<string, ServiceModelPerformanceCountersEntry>();
                        }
                    }
                }
                return PerformanceCounters.performanceCountersBaseUri;
            }
        }


        internal static void AddPerformanceCountersForEndpoint(
            ServiceHostBase serviceHost,
            ContractDescription contractDescription,
            EndpointDispatcher endpointDispatcher)
        {
            Fx.Assert(serviceHost != null, "The 'serviceHost' argument must not be null.");
            Fx.Assert(contractDescription != null, "The 'contractDescription' argument must not be null.");
            Fx.Assert(endpointDispatcher != null, "The 'endpointDispatcher' argument must not be null.");
            
            bool performanceCountersEnabled = PerformanceCounters.PerformanceCountersEnabled;
            bool minimalPerformanceCountersEnabled = PerformanceCounters.MinimalPerformanceCountersEnabled;

            if (performanceCountersEnabled || minimalPerformanceCountersEnabled)
            {
                if (endpointDispatcher.SetPerfCounterId())
                {
                    ServiceModelPerformanceCounters counters;
                    lock (PerformanceCounters.perfCounterDictionarySyncObject)
                    {
                        if (!PerformanceCounters.Perform